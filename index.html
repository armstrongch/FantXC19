<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>FantXC Simulator 2019</title>
  <style type="text/css">
   
  </style>
  </head>
  <body onload="setupGame()">
    <p id="testP"></p>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script>
    	var runnerList = [];
    	var finisherList = [];
    	var handSize = 3;
    	
    	var cardList = 
    	{
    	  "Run": new card(1000, 10, "", 0),
    	  "Fatigue": new card(600, 0, "", 99)
    	};
    	
    	function card(distance, energy, specialText, priority)
    	{
    	    this.distance = distance;
    	    this.energy = energy;
    	    this.specialText = specialText;
    	    this.priority = priority;
    	}
    	
    	function setupGame()
      {
      	setupRace(3);
      	runRace();
      }
      
      function setupRace(numRunners)
      {
          runnerList = [];
          finisherList = [];
          for (let i = 0; i < numRunners; i++)
          {
              var runner = new createRunner(runnerList);
              shuffle(runner.deck);
              //deck.length MUST be more than handSize, or this WILL break
              for (let i = 0; i < handSize; i++)
              {
                runner.hand.push(runner.deck.pop)
              }
              runnerList.push(runner);
          }
          showMessage("Race will have " + numRunners + " runners.");
      }
      
      function runRace()
      {
        while (runnerList.length > finisherList.length)
        {
          raceRound();
        }
      }
      
      function raceRound()
      {
        showMessage(finisherList.length + " of " + runnerList.length + " runners have finished.");
        runnerList.sort(dynamicSort("-position"));
        runnerList.length = 0;
      }
      
      function createRunner(runnerList)
    	{
    		this.isPlayer = false;
    		this.id = runnerList.length;
    		this.position = 0;
    		this.energy = 100;
    		this.deck = ["Run", "Run", "Run"];
    		this.hand = [];
    		this.discard = [];
    	}
    	
    	//From Stack Overflow: https://stackoverflow.com/questions/1129216/sort-array-of-objects-by-string-property-value
  		function dynamicSort(property) 
  		{
  			var sortOrder = 1;
  			
  			if(property[0] === "-") 
  			{
  				sortOrder = -1;
  				property = property.substr(1);
  			}
  			return function (a,b) 
  			{
  				/* next line works with strings and numbers, 
  				 * and you may want to customize it to your needs
  				 */
  				var result = (a[property] < b[property]) ? -1 : (a[property] > b[property]) ? 1 : 0;
  				return result * sortOrder;
  			}
  		}
    	
    	//From: https://javascript.info/task/shuffle
    	function shuffle(array) 
    	{
        array.sort(() => Math.random() - 0.5);
      }
    	
    	function showMessage(text)
  		{
  			$('#testP').html(
  				$('#testP').html()
  				+ "<br/>"
  				+ text
  			);
  		}
    </script>
  </body>
</html>
